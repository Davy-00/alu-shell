#!/usr/bin/env bash
# Script to process Apache-style log files and generate error reports

while read -r line; do
    # Skip lines that don't match expected format
    if ! [[ "$line" =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+.* ]]; then
        continue
    fi

    # Extract IP and status code
    ip=$(echo "$line" | awk '{print $1}')
    status=$(echo "$line" | awk '{print $9}')

    # Count occurrences
    if [[ -n "$ip" && -n "$status" ]]; then
        if [[ "$status" =~ ^[0-9]+$ ]]; then
            counts["$ip $status"]=$((${counts["$ip $status"]} + 1))
        fi
    fi
done < "$1"

# Print results sorted by count in descending order
for key in "${!counts[@]}"; do
    echo "${counts[$key]} $key"
done | sort -rn

